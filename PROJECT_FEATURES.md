# XNote - 多媒体记事本应用

## 📱 项目简介

XNote 是一款功能丰富的 Android 记事本应用，采用现代化的 MVVM 架构设计，支持文本、图片、音频等多媒体内容的混合编辑。应用注重用户体验和数据安全，提供了完整的记事管理、分类组织、导出导入、搜索等功能。

## ⭐ 核心特性

### 🎨 富文本编辑系统
- **多媒体混合编辑**: 在同一编辑器中自由组合文本、图片、音频
- **所见即所得**: 媒体内容直接嵌入文本流中显示
- **原生编辑体验**: 支持全选、复制、粘贴等标准文本操作
- **实时预览**: 图片缩略图、音频播放控件即时显示
- **自适应布局**: 自动调整媒体尺寸适配屏幕

### 📁 分类管理系统
- **预设分类**: 默认提供"日常、工作、感悟"三个分类
- **自定义分类**: 支持创建个人定制分类标签
- **分类筛选**: 按分类快速筛选记事内容
- **分类标签**: 记事编辑界面显示当前分类
- **批量管理**: 支持批量修改记事分类

### 🔍 智能搜索功能
- **全文搜索**: 搜索记事标题和文本内容
- **实时搜索**: 输入时即时显示匹配结果
- **关键词高亮**: 搜索结果中突出显示关键词
- **搜索历史**: 记录常用搜索关键词
- **模糊匹配**: 支持中英文模糊搜索

### 🎵 音频录制播放
- **实时录音**: 内置高质量音频录制功能
- **录音控制**: 支持录音、暂停、取消操作
- **音频播放**: 点击音频块即可播放/暂停
- **音频管理**: 自动管理音频文件存储
- **格式支持**: 支持多种音频格式

### 📷 图片插入管理
- **多种来源**: 支持相册选择、拍照获取
- **智能压缩**: 自动压缩图片减少存储占用
- **尺寸显示**: 保持图片原始比例显示
- **快速预览**: 支持图片放大预览
- **格式兼容**: 支持 JPG、PNG、WebP 等格式

### 💾 数据导出导入
- **加密导出**: AES-256 加密保护导出数据
- **完整打包**: 包含文本、图片、音频的完整备份
- **密码保护**: 用户自定义导出密码
- **增量导入**: 支持覆盖或追加导入模式
- **格式验证**: 严格验证导入文件格式和安全性

### 🛡️ 安全防护系统
- **ZIP炸弹防护**: 防止恶意压缩文件攻击
- **路径遍历防护**: 防止文件路径遍历攻击
- **临时文件安全删除**: 多次覆写确保数据彻底清除
- **加密配置存储**: 敏感配置硬件级加密存储
- **权限最小化**: 严格控制应用权限范围

## 🏗️ 技术架构

### 架构模式
- **MVVM**: Model-View-ViewModel 分离关注点
- **Repository**: 统一数据访问层
- **Room**: 本地数据库持久化
- **Kotlin Coroutines**: 异步编程和并发处理
- **StateFlow**: 响应式数据流管理

### 数据模型
```
Note (记事)
├── id: String (唯一标识)
├── title: String (标题)
├── categoryId: String (分类ID)
├── createdAt: Long (创建时间)
├── updatedAt: Long (更新时间)
└── blocks: List<NoteBlock> (内容块列表)

NoteBlock (内容块)
├── id: String (块ID)
├── noteId: String (所属记事ID)
├── type: BlockType (TEXT/IMAGE/AUDIO)
├── order: Int (排序顺序)
├── text: String? (文本内容)
├── url: String? (媒体文件路径)
├── alt: String? (替代文本)
├── duration: Long? (音频时长)
├── width/height: Int? (媒体尺寸)

Category (分类)
├── id: String (分类ID)
├── name: String (分类名称)
├── isDefault: Boolean (是否默认分类)
└── createdAt: Long (创建时间)
```

## 📱 用户界面

### 主界面 (MainActivity)
- **记事列表**: RecyclerView 显示记事摘要
- **搜索功能**: 可展开/收起的搜索栏
- **新建按钮**: 浮动操作按钮快速创建记事
- **批量操作**: 长按进入多选模式
- **导出导入**: 菜单提供数据管理功能
- **空状态**: 友好的空列表提示界面

### 编辑界面 (NoteEditActivity)
- **标题输入**: 顶部大字号标题输入框
- **时间显示**: 显示记事修改时间
- **分类标签**: 时间右侧显示当前分类
- **富文本编辑器**: 自定义 RichEditText 组件
- **工具栏**: 底部媒体插入和操作工具
- **录音面板**: 录音时显示的控制面板
- **自动保存**: 检测内容变更自动保存

### 交互设计
- **Material Design**: 遵循 Google Material 设计规范
- **流畅动画**: 界面切换和状态变更动画
- **触觉反馈**: 重要操作提供触觉反馈
- **无障碍支持**: 支持屏幕阅读器等辅助功能
- **深色模式**: 自适应系统主题模式

## 🔧 核心组件

### RichEditText
- **继承**: 基于 AppCompatEditText 扩展
- **Spannable**: 使用 Android Spannable 实现富文本
- **媒体嵌入**: 自定义 MediaSpan 实现媒体显示
- **事件处理**: 处理点击、长按等交互事件
- **数据转换**: 与 NoteBlock 数据模型双向转换

### 音频系统
- **AudioRecorder**: 封装 MediaRecorder 提供录音功能
- **AudioPlayer**: 基于 ExoPlayer 实现音频播放
- **权限管理**: 动态申请录音权限
- **生命周期**: 与 Activity 生命周期绑定管理

### 数据库层
- **Room Database**: SQLite 数据库封装
- **DAO 接口**: 数据访问对象定义
- **类型转换**: 自定义 Converter 处理复杂类型
- **迁移策略**: 数据库版本升级迁移

### 文件管理
- **FileUtils**: 文件操作工具类
- **ImageUtils**: 图片处理和压缩工具
- **安全验证**: 文件类型和大小验证
- **路径管理**: 应用私有目录文件管理

## 📊 性能优化

### 内存优化
- **图片压缩**: 智能压缩减少内存占用
- **懒加载**: 列表项按需加载内容
- **缓存策略**: 合理使用内存缓存
- **生命周期**: 及时释放不需要的资源

### 存储优化
- **增量更新**: 只更新变更的数据块
- **文件去重**: 避免重复存储相同文件
- **定期清理**: 清理无用的临时文件
- **压缩存储**: 对大文件进行压缩存储

### 数据库优化
- **索引优化**: 为查询字段添加索引
- **分页查询**: 大数据量分页加载
- **事务管理**: 批量操作使用事务
- **连接池**: 合理管理数据库连接

## 🔒 安全特性

### 数据保护
- **本地加密**: 敏感数据本地加密存储
- **传输安全**: 导出数据加密传输
- **权限控制**: 最小权限原则
- **隐私保护**: 不收集用户隐私数据

### 攻击防护
- **输入验证**: 严格验证用户输入
- **文件安全**: 防止恶意文件注入
- **路径安全**: 防止路径遍历攻击
- **内存安全**: 防止内存泄露和溢出

## 📈 扩展性设计

### 模块化设计
- **功能模块**: 按功能划分独立模块
- **接口抽象**: 定义清晰的模块接口
- **依赖注入**: 使用依赖注入降低耦合
- **插件架构**: 支持功能插件扩展

### 国际化支持
- **多语言**: 支持中英文等多种语言
- **本地化**: 适配不同地区的使用习惯
- **字体适配**: 支持不同语言字体显示
- **布局适配**: 适配不同语言的界面布局

## 🎯 未来规划

### 功能扩展
- **云同步**: 支持多设备数据同步
- **协作功能**: 记事分享和协作编辑
- **AI辅助**: 智能分类和内容建议
- **主题定制**: 更多个性化主题选项
- **插件生态**: 开放插件开发接口

### 性能提升
- **启动优化**: 进一步优化应用启动速度
- **内存优化**: 更精细的内存管理策略
- **电量优化**: 降低后台耗电量
- **存储优化**: 更高效的数据存储策略

---

**XNote** - 让记录变得更简单、更安全、更高效！